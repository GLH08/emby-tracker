# Emby Tracker 功能完善计划

> 目标：复刻 Trakt.tv 核心功能，打造中文友好的个人流媒体追踪平台

## 项目概述

本项目旨在追踪 Emby 服务器播放进度，统计流媒体播放记录，获取最新的流媒体信息，收集个人流媒体播放喜好。相比 Trakt，本项目优势：
- 完整中文支持
- 无需订阅，所有功能免费
- 与 Emby 深度集成
- 自托管，数据隐私可控

---

## 第一阶段：基础增强

### 1.1 日历视图
- **状态**：✅ 已完成
- **优先级**：高
- **描述**：显示追剧更新时间表和即将上映的电影
- **实现方式**：
  - 后端：新增 `/api/calendar` 路由，从 TMDB 获取剧集播出时间
  - 前端：新增 `Calendar.vue` 页面，使用日历组件展示
  - 数据源：TMDB API 获取剧集播出日期
- **功能点**：
  - [x] 周视图/月视图切换
  - [x] 显示正在追的剧集更新
  - [x] 显示即将上映的电影
  - [x] 点击跳转到详情页
  - [x] iCal 导出功能

### 1.2 剧集进度追踪
- **状态**：⏳ 待开发
- **优先级**：高
- **描述**：追踪剧集观看进度，显示完成百分比
- **实现方式**：
  - 后端：新增 `/api/progress` 路由，计算剧集观看进度
  - 前端：在剧集详情页和专门的进度页面展示
  - 数据库：利用现有 WatchHistory 表计算
- **功能点**：
  - [ ] 剧集总体完成百分比
  - [ ] 每季进度条
  - [ ] "下一集"提醒
  - [ ] 未看集数统计
  - [ ] 进度页面（类似 Trakt 的 Progress）

### 1.3 统计增强
- **状态**：⏳ 待开发
- **优先级**：中
- **描述**：增强统计功能，提供更丰富的数据可视化
- **实现方式**：
  - 后端：扩展 `/api/stats` 路由
  - 前端：使用图表库（如 Chart.js）展示
- **功能点**：
  - [ ] 30天观看趋势图（每日观看数量）
  - [ ] 按日期分组的观看记录
  - [ ] 观看时段分布（早/中/晚/深夜）
  - [ ] 每周观看热力图
  - [ ] 观看连续天数统计

---

## 第二阶段：发现与推荐

### 2.1 TMDB 深度集成
- **状态**：⏳ 待开发
- **优先级**：高
- **描述**：集成 TMDB API，获取丰富的影视信息
- **实现方式**：
  - 后端：新增 `/api/tmdb` 路由，封装 TMDB API
  - 前端：在发现页面展示
  - 缓存：使用 MediaCache 表缓存 TMDB 数据
- **功能点**：
  - [ ] 热门电影/剧集
  - [ ] 即将上映内容
  - [ ] 按类型浏览
  - [ ] 按年份浏览
  - [ ] 中文元数据（标题、简介）
  - [ ] 演员/导演信息

### 2.2 推荐系统
- **状态**：⏳ 待开发
- **优先级**：中
- **描述**：基于观看历史的个性化推荐
- **实现方式**：
  - 后端：分析用户观看历史，计算类型偏好
  - 算法：基于类型相似度 + TMDB 推荐 API
- **功能点**：
  - [ ] 基于类型偏好推荐
  - [ ] "因为你看过 X" 推荐
  - [ ] 相似影片推荐
  - [ ] 热门推荐（结合个人偏好）

### 2.3 流媒体可用性查询
- **状态**：⏳ 待开发
- **优先级**：低
- **描述**：显示影片在哪个流媒体平台可观看
- **实现方式**：
  - 使用 TMDB 的 Watch Providers API
  - 支持中国区流媒体平台
- **功能点**：
  - [ ] 显示可观看平台
  - [ ] 平台链接跳转
  - [ ] 按平台筛选

---

## 第三阶段：高级功能

### 3.1 多列表管理
- **状态**：⏳ 待开发
- **优先级**：中
- **描述**：支持创建多个自定义列表
- **实现方式**：
  - 数据库：新增 CustomList 和 CustomListItem 表
  - 后端：新增 `/api/lists` 路由
  - 前端：列表管理页面
- **功能点**：
  - [ ] 创建/编辑/删除列表
  - [ ] 添加/移除列表项
  - [ ] 列表排序（手动/按添加时间/按评分）
  - [ ] 列表描述和封面
  - [ ] 公开链接分享

### 3.2 评分系统
- **状态**：⏳ 待开发
- **优先级**：中
- **描述**：个人评分功能
- **实现方式**：
  - 数据库：新增 Rating 表
  - 后端：新增 `/api/ratings` 路由
  - 前端：评分组件
- **功能点**：
  - [ ] 1-10 分评分
  - [ ] 评分历史
  - [ ] 评分统计（平均分、分布）
  - [ ] 在详情页显示个人评分

### 3.3 Check-in 功能
- **状态**：⏳ 待开发
- **优先级**：低
- **描述**：实时标记正在观看的内容
- **实现方式**：
  - 数据库：新增 Checkin 表
  - 后端：新增 `/api/checkin` 路由
  - 前端：Check-in 按钮和状态显示
- **功能点**：
  - [ ] 一键 Check-in
  - [ ] 显示当前正在观看
  - [ ] Check-in 历史
  - [ ] 自动结束（播放完成后）

### 3.4 数据导入/导出
- **状态**：⏳ 待开发
- **优先级**：中
- **描述**：支持数据备份和迁移
- **实现方式**：
  - 后端：新增 `/api/import` 和 `/api/export` 路由
  - 支持格式：JSON、CSV
- **功能点**：
  - [ ] 从 Trakt 导入历史（JSON 格式）
  - [ ] 导出观看历史（JSON/CSV）
  - [ ] 导出想看列表
  - [ ] 导出评分
  - [ ] 完整备份/恢复

---

## 第四阶段：高级统计与报告

### 4.1 年度回顾
- **状态**：⏳ 待开发
- **优先级**：低
- **描述**：年度观看总结报告
- **实现方式**：
  - 后端：新增 `/api/stats/yearly` 路由
  - 前端：专门的年度回顾页面
- **功能点**：
  - [ ] 年度观看总时长
  - [ ] 观看最多的类型
  - [ ] 最爱的演员/导演
  - [ ] 观看里程碑
  - [ ] 月度对比图表
  - [ ] 可分享的年度报告图片

### 4.2 高级筛选
- **状态**：⏳ 待开发
- **优先级**：低
- **描述**：更强大的筛选和搜索功能
- **实现方式**：
  - 后端：扩展现有 API 的筛选参数
  - 前端：高级筛选面板
- **功能点**：
  - [ ] 按演员筛选
  - [ ] 按导演筛选
  - [ ] 按评分范围筛选
  - [ ] 按观看状态筛选
  - [ ] 按年份范围筛选
  - [ ] 组合筛选

---

## 技术栈

- **后端**：Python FastAPI + SQLAlchemy + SQLite
- **前端**：Vue 3 + Vite + TailwindCSS
- **外部 API**：TMDB API（影视信息）
- **部署**：Docker Compose + GitHub Actions

---

## 开发进度

| 阶段 | 功能 | 状态 | 完成日期 |
|------|------|------|----------|
| 1.1 | 日历视图 | ✅ 已完成 | 2024-12-28 |
| 1.2 | 剧集进度追踪 | ⏳ 待开发 | - |
| 1.3 | 统计增强 | ⏳ 待开发 | - |
| 2.1 | TMDB 深度集成 | ⏳ 待开发 | - |
| 2.2 | 推荐系统 | ⏳ 待开发 | - |
| 2.3 | 流媒体可用性 | ⏳ 待开发 | - |
| 3.1 | 多列表管理 | ⏳ 待开发 | - |
| 3.2 | 评分系统 | ⏳ 待开发 | - |
| 3.3 | Check-in 功能 | ⏳ 待开发 | - |
| 3.4 | 数据导入/导出 | ⏳ 待开发 | - |
| 4.1 | 年度回顾 | ⏳ 待开发 | - |
| 4.2 | 高级筛选 | ⏳ 待开发 | - |

---

## 环境变量新增

```env
# TMDB API（必需，用于发现和推荐功能）
TMDB_API_KEY=your_tmdb_api_key
TMDB_LANGUAGE=zh-CN
TMDB_REGION=CN
```

---

## 更新日志

### 2024-12-28
- 创建功能完善计划文档
- ✅ 完成 1.1 日历视图功能
  - 后端：calendar.py 路由（剧集/电影/全部/我的剧集/iCal导出）
  - 前端：Calendar.vue 页面（周/月视图、筛选、导航）
  - 组件：CalendarItem.vue 日历项组件
